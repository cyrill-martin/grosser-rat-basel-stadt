import{_ as Ae,bc as Me,i as Se,j as Ce,n as w,r as b,c as g,o as Q,f as j,d as ee,b as k,au as De,Z as ze,a9 as Ie}from"./index-BLDw-dF1.js";import{d as s,a as te,c as N,o as Fe,b as C,f as ae}from"./customColors-DHX7j9QZ.js";import{d as Te}from"./debounce-B_grFKK4.js";const Oe={id:"tooltip"},Xe={key:0,class:"headshot"},_e={class:"url"},He=20,Le={__name:"TheGrandCouncil",setup(Ve){const v=Me(),u=Se();Ce(()=>{f.value=s.select("#tooltip"),E(),u.numberOfFetches>0&&I()}),w(()=>v.width,()=>{ne()});const ne=Te(()=>{le()},200);async function le(){s.select("#svg-visualization").remove(),await E(),await W(x.value),i.value==="occupation"&&await B("increased")}const V=b(null),D=b(null),l=b({width:null,height:null,margin:{top:null,right:null,bottom:null,left:null},ctrWidth:null,ctrHeight:null}),x=g(()=>u.asOfDate&&u.membersAsOfDate?u.membersAsOfDate:u.membersCurrent),i=g(()=>u.seatArrangement?u.seatArrangement:""),o=g(()=>u.seatFeature),$=g(()=>u.memberFocus),p=g(()=>{if(!i.value)return[""];const e=P(i.value);if(z(e[0])){const t=s.min(e),n=s.max(e);return n-t>100&&t===0?[1,n]:t===n?[t,1]:[t,n]}return e.sort()});function z(e){return Number.isInteger(Number(e))}function P(e){return Array.from(new Set(x.value.map(t=>t[e])))}const c=g(()=>{const t=typeof p.value[0]=="string",n=p.value[1]<=100;return t?(u.setXAxisIsLog(!1),{type:"band"}):!t&&n?(u.setXAxisIsLog(!1),{type:"linear"}):(u.setXAxisIsLog(!0),{type:"log"})});w(()=>c.value,(e,t)=>{const n=e.type!==t.type;oe(n)},{deep:!1}),w(()=>i.value,async(e,t)=>{await I(),e==="occupation"&&await B("increased"),t==="occupation"&&await B("regular")}),w(()=>o.value,()=>{I()}),w(()=>$.value,()=>{W(x.value)});const y=b(null),A=b(null);w(()=>u.newFetchingDone,async e=>{e&&I()});const Y=b(null);async function E(){await re(),await K()}async function re(){const e=s.select("#grand-council-basel");await ie(e),V.value=e.append("svg").attr("id","svg-visualization").attr("viewBox",`0 0 ${l.value.width} ${l.value.height}`),D.value=V.value.append("g").attr("id","visualization-ctr").attr("transform",`translate(${l.value.margin.left}, ${l.value.margin.top})`)}async function B(e){const t=e==="increased"?T.value*100*1.1:l.value.height,n=e==="increased"?"270":"0",h=s.transition().duration(2500),r=h.transition().duration(1500);await V.value.transition(h).attr("viewBox",`0 0 ${l.value.width} ${t}`).attr("transform",`rotate(${n})`),e==="increased"&&await A.value.selectAll("text").transition(r).style("text-anchor","start").style("font-size",()=>v.isMobile?"6px":"14px").attr("dy",()=>v.isMobile?"-0.1rem":".1rem").attr("dx",()=>-l.value.ctrHeight+F.value*m.value*2).attr("transform","rotate(90)")}async function ie(e){l.value.width=e.node().getBoundingClientRect().width;const t=v.isMobile?.5:.3;l.value.height=l.value.width*t,l.value.margin.top=v.isMobile?10:50,l.value.margin.right=v.isMobile?5:25,l.value.margin.bottom=v.isMobile?18:25,l.value.margin.left=v.isMobile?5:25,l.value.ctrWidth=l.value.width-l.value.margin.left-l.value.margin.right,l.value.ctrHeight=l.value.height-l.value.margin.top-l.value.margin.bottom}async function I(){await x.value.sort((r,d)=>{if(i.value){if(r[i.value]<d[i.value])return-1;if(r[i.value]>d[i.value])return 1}if(o.value){if(r[o.value]<d[o.value])return-1;if(r[o.value]>d[o.value])return 1}else{if(r.name<d.name)return-1;if(r.name>d.name)return 1}});let e=null,t=-1,n=-1;x.value.forEach(r=>{r[i.value]!==e?(e=r[i.value],t=0):t+=1,r.innerIndex=t,t>n&&(n=t)}),F.value=n+1,console.log(x.value);const h=x.value.map(r=>({name:r.name,[i.value]:r[i.value],[o.value]:r[o.value]}));console.log(h),await ye(),await W(x.value)}async function K(){await ue(),await se()}async function ue(){c.value.type==="band"?y.value=s.scaleBand().domain(p.value).range([0,l.value.ctrWidth]).paddingInner(.2).paddingOuter(.2).align(.5):c.value.type==="linear"?y.value=s.scaleLinear().domain(p.value).range([0,l.value.ctrWidth]).nice():y.value=s.scaleLog().domain(p.value).range([l.value.ctrWidth*.05,l.value.ctrWidth]).base(2).nice()}async function se(){A.value=D.value.append("g").attr("id","x-axis").attr("transform",`translate(0, ${l.value.ctrHeight})`).style("font-size",()=>v.isMobile?"8px":"14px"),Z()}async function oe(e){e?(s.select("#x-axis").remove(),K()):(y.value.domain(p.value),Z())}function Z(){const e=s.formatLocale({thousands:"'",grouping:[3]}).format(",.0f"),t=s.axisBottom(y.value);if(c.value.type==="band"&&t.tickSize(0),c.value.type==="linear"){const n=p.value[1]<10?p.value[1]:12;t.tickSize(-l.value.ctrHeight).ticks(n).tickPadding(10).tickSizeOuter(0).tickFormat(e)}c.value.type==="log"&&t.tickSize(-l.value.ctrHeight).ticks(5).tickPadding(10).tickSizeOuter(0).tickFormat(e),A.value.transition().call(t),c.value.type==="band"?A.value.call(n=>n.select(".domain").remove()):A.value.selectAll(".tick line").style("stroke","lightgrey").style("stroke-dasharray","4,2")}const F=b(0),M=g(()=>c.value.type==="band"?Math.ceil(He/p.value.length):1),q=g(()=>c.value.type==="band"?Math.ceil(F.value/M.value):F.value),ce=g(()=>c.value.type==="band"?y.value.bandwidth():null),T=g(()=>c.value.type==="band"?ce.value/M.value:l.value.ctrWidth/(p.value[1]-p.value[0])),O=g(()=>l.value.ctrHeight/q.value),m=g(()=>{const t=T.value/2*.9,n=O.value/2*.9;return c.value.type==="band"?q.value>M.value?Math.min(t,n):t:c.value.type==="linear"?Math.min(t,n):v.isMobile?3.3:5});function X(e){return c.value.type==="band"?ve(e):c.value.type==="linear"?me(e):ge(e)}function _(e,t="update"){return t==="enter"?-m.value*2:t==="exit"?l.value.ctrHeight+m.value*2:c.value.type==="band"?fe(e):c.value.type==="linear"?de(e):pe(e)}function ve(e){const t=i.value?e[i.value]:"",n=e.innerIndex%M.value;return y.value(t)+n*T.value+T.value/2}function fe(e){const t=Math.floor(e.innerIndex/M.value);return i.value!=="occupation"?p.value[0]===""?t*O.value+O.value/2:t*O.value:t*m.value*2}function me(e){return y.value(e[i.value])}function de(e){return l.value.ctrHeight-m.value-e.innerIndex*m.value*2}function ge(e){return e[i.value]!==0?y.value(e[i.value]):10}function pe(e){return l.value.ctrHeight-m.value-e.innerIndex*m.value*2}const U=g(()=>c.value.type==="log"?.65:.9);function he(e){return e in N||z(e)}const R=g(()=>{if(!o.value)return{};const e=P(o.value),t=z(e[0]);let n,h;if(t){const r=s.min(e),d=s.max(e);n=d-r>100?"log":"linear",h=d-r>100&&r===0?[1,d]:[r,d]}else n=he(o.value)?"custom":"ordinal",h=e.sort();return{type:n,domain:h}});async function ye(){const{type:e,domain:t}=R.value,n={ordinal:()=>s.scaleOrdinal().domain(t).range(Fe),linear:()=>s.scaleLinear().domain(t).range([C.lowColor,C.highColor]),log:()=>s.scaleLog().domain(t).range([C.lowColor,C.highColor]),default:()=>null};Y.value=(n[e]||n.default)()}function H(e){if(!o.value)return"#000000";if(R.value.type==="custom"){const t=e[o.value];return z(o.value)?N.vote[t]:N[o.value][t]}return R.value.type==="log"&&e[o.value]===0?C.logZeroColor:Y.value(e[o.value])}const f=b(null);function J(e){const t=u.focusOptions.findIndex(n=>n.value===e.id);return ae[t%ae.length]}async function W(e){let t=D.value.select(".seats-group");t.empty()&&(t=D.value.append("g").attr("class","seats-group"));const n=s.transition().duration(2500),h=u.numberOfFetches===1?s.transition().duration(2500):n.transition().duration(2500),r=s.transition().duration(2500),d=t.selectAll("circle").data(e,a=>a.id);d.exit().transition(n).attr("cx",a=>X(a)).attr("cy",a=>_(a,"exit")).attr("r",m.value).attr("fill",a=>H(a)).attr("fill-opacity",0).remove(),d.enter().append("circle").attr("class","seat").attr("cx",a=>X(a)).attr("cy",a=>_(a,"enter")).attr("r",m.value).attr("fill",a=>H(a)).attr("fill-opacity",0).attr("stroke",a=>a.focus?J(a):null).attr("stroke-width",a=>a.focus?m.value*2:null).attr("stroke-opacity",a=>a.focus?te:null).on("click",(a,S)=>{v.isMobile||window.open(S.url,"_blank")}).on("mouseover",(a,S)=>setTimeout(()=>{xe(S)},v.isMobile?100:0)).on("mousemove",a=>be(a)).on("mouseout",()=>we()).on("contextmenu",(a,S)=>ke(a,S)).transition(h).attr("cx",a=>X(a)).attr("cy",a=>_(a)).attr("fill",a=>H(a)).attr("fill-opacity",U.value).attr("cursor","pointer"),d.transition(r).attr("cx",a=>X(a)).attr("cy",a=>_(a)).attr("r",m.value).attr("fill",a=>H(a)).attr("fill-opacity",U.value).attr("stroke",a=>a.focus?J(a):null).attr("stroke-width",a=>a.focus?m.value*2:null).attr("stroke-opacity",a=>a.focus?te:null).attr("cursor","pointer"),s.select(".seats-group").raise()}let L=!1;function xe(e){if(u.membersAsOfDate||f.value.select(".headshot img").attr("src",e.image),f.value.select(".name").text(e.name),i.value===o.value?f.value.select(".arrangement").text(e[i.value]):(f.value.select(".arrangement").text(e[i.value]),f.value.select(".feature").text(e[o.value])),v.isMobile){const n=f.value.select(".url").select("a");n.attr("href",e.url),n.on("click",h=>{h.stopPropagation(),L=!0})}f.value.style("visibility","visible")}function be(e){f.value.style("left",`${e.clientX+m.value}px`).style("top",`${e.clientY-m.value}px`)}function we(){v.isMobile?setTimeout(()=>{L&&(L=!1),G()},L?1500:0):setTimeout(()=>{G()},0)}function G(){u.membersAsOfDate||f.value.select(".headshot img").attr("src",null),f.value.select(".name").text(null),f.value.select(".arrangement").text(null),f.value.select(".feature").text(null),f.value.select(".hint").text(null),v.isMobile&&f.value.select(".url").select("a").attr("href",""),f.value.style("visibility","hidden")}function ke(e,t){e.preventDefault(),u.memberFocus?$.value.includes(t.id)||u.setMemberFocus([...$.value,t.id]):u.setMemberFocus([t.id])}return(e,t)=>(Q(),j("div",Oe,[ee(u).membersAsOfDate?De("",!0):(Q(),j("div",Xe,t[0]||(t[0]=[k("img",null,null,-1)]))),t[2]||(t[2]=k("div",{class:"name"},null,-1)),t[3]||(t[3]=k("div",{class:"arrangement"},null,-1)),t[4]||(t[4]=k("div",{class:"feature"},null,-1)),ze(k("div",_e,t[1]||(t[1]=[k("a",{href:"",target:"_blank"},"Link",-1)]),512),[[Ie,ee(v).isMobile]])]))}},We=Ae(Le,[["__scopeId","data-v-9ee7adc7"]]);export{We as default};
