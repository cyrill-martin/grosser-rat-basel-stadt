import{_ as Ve,bq as Fe,i as Ie,aj as Ne,j as ze,q as k,r as T,c as w,o as ue,f as ie,d as se,b as C,aG as Be,a3 as Xe,af as _e}from"./index-Dv99kkqF.js";import{d as f,a as oe,c as J,o as He,b as N,f as ce}from"./customColors-C01acNKr.js";import{d as Pe}from"./debounce-B_grFKK4.js";async function We(a,r,t,s,c){const y=await nt(a,r,t);return Re(y,r,t,s)}function Re(a,r,t,s){const c="100 Menschen",y=Ye(r,s),d=qe(a.featuring,s),g=Ee(t),l=ve(a.groups.length),O=`${a.groups.length} ${l}`,o=Ue(a);console.log(o);const L=`GrÃ¶sste ${ve(o.length)}: ${Ze(o)}`,M=Qe(a,O,L,y),$=et(a,g,o,s,d);let D=`${c}.
${M}
`;return $&&(D+=`${$}`),tt(D)}const S=["party","fraction","constituency","gender","ageGroup","occupation"];function z(a){return Number.isInteger(Number(a))}function Ye(a,r){return a?r.arrangement:r.feature}function qe(a,r){return a?r.feature:null}function Ee(a){return a&&z(a)?"@Abstimmung@":"@"}function ve(a){return a===1?"Gruppe":"Gruppen"}function Ke(a){return a.groups.reduce((t,s)=>s.nrOfMembers>t?s.nrOfMembers:t,0)}function Ue(a){const r=Ke(a);return a.groups.filter(s=>s.nrOfMembers===r)}function me(a){return a===1?"Person":"Personen"}function Ze(a){return a.map(r=>{const t=me(r.nrOfMembers);return`'${r.name}' (${r.nrOfMembers} ${t})`}).join(", ")}function Je(a){return a.map(t=>{const s=me(t.nrOfMembers);return`- ${t.name} (${t.nrOfMembers} ${s})
`}).join("")}function Qe(a,r,t,s){let c;return S.includes(a.groupedBy)||z(a.groupedBy)?c=`${r}.
${t}.`:c=`${s}: Min: ${a[a.groupedBy].min}, Max: ${a[a.groupedBy].max}, Schnitt: ${a[a.groupedBy].mean}.
${r}.
${t}.`,c}function je(a,r,t,s){let c;return r==="@Abstimmung@"?c=a.subGroups.length===1?"Abstimmungsresultat":"Abstimmungsresultate":c=a.subGroups.length===1?t:s.featurePlural,c}function et(a,r,t,s,c){let y;return a.featuring&&(S.includes(a.featuring)||z(a.featuring))?y=t.map(d=>{const g=je(d,r,c,s);return`...darin ${d.subGroups.length} ${g}:
${Je(d.subGroups)}`}).join(`
`):a.featuring&&!S.includes(a.featuring)&&(y=t.map(d=>`${c} in '${d.name}': Min: ${d[a.featuring].min}, Max: ${d[a.featuring].max}, Schnitt: ${d[a.featuring].mean}.`).join(`
`)),y}function tt(a){return a.replace(/@/g," ")}function q(a,r){return{min:f.min(a,t=>t[r]),max:f.max(a,t=>t[r]),mean:Math.round(10*f.mean(a,t=>t[r]))/10}}function Q(a){const r=[];for(const[t,s]of a.entries())r.push({name:t,nrOfMembers:s.length});return r}function fe(a){const r=[];for(const[t,s]of a.entries()){const c=[];let y=0;for(const[d,g]of s.entries()){const l=g.length;y+=l,c.push({name:d,nrOfMembers:l})}r.push({name:t,nrOfMembers:y,subGroups:c})}return r}async function nt(a,r,t){const s=[],c={groupedBy:r||t,groups:null},y=r?z(r):!1,d=t?z(t):!1;r&&t&&(c.featuring=t);let g;if(r&&(S.includes(r)||y)){if(s.push(l=>l[r]),t&&(S.includes(t)||d)&&s.push(l=>l[t]),g=f.group(a,...s),s.length===1&&(c.groups=Q(g)),s.length===2&&(c.groups=fe(g)),t&&!S.includes(t)&&!d){let l=0;for(const O of g.values())c.groups[l][t]=q(O,t),l++}}else if(r&&!S.includes(r)&&!y){if(c[r]=q(a,r),s.push(l=>l[r]),t&&(S.includes(t)||d)&&s.push(l=>l[t]),g=f.group(a,...s),s.length===1&&(c.groups=Q(g)),s.length===2&&(c.groups=fe(g)),t&&!S.includes(t)&&!d){let l=0;for(const O of g.values())c.groups[l][t]=q(O,t),l++}}else r||t&&(s.push(l=>l[t]),g=f.group(a,...s),c.groups=Q(g),!S.includes(t)&&!d&&(c[t]=q(a,t)));return c}const at={id:"tooltip"},rt={key:0,class:"headshot"},lt={class:"url"},ut=20,it={__name:"TheGrandCouncil",setup(a){const r=Fe(),t=Ie(),{t:s}=Ne();ze(()=>{h.value=f.select("#tooltip"),ee(),t.numberOfFetches>0&&B()}),k(()=>r.width,()=>{c()});const c=Pe(()=>{y()},200);async function y(){f.select("#svg-visualization").remove(),await ee(),await U(O.value),o.value==="occupation"&&await E("increased")}const d=T(null),g=T(null),l=T({width:null,height:null,margin:{top:null,right:null,bottom:null,left:null},ctrWidth:null,ctrHeight:null}),O=w(()=>t.asOfDate&&t.membersAsOfDate?t.membersAsOfDate:t.membersCurrent),o=w(()=>t.seatArrangement?t.seatArrangement:""),m=w(()=>t.seatFeature),L=w(()=>t.memberFocus),M=w(()=>{if(!o.value)return[""];const e=D(o.value);if($(e[0])){const n=f.min(e),i=f.max(e);return i-n>100&&n===0?[1,i]:n===i?[n,1]:[n,i]}return e.sort()});function $(e){return Number.isInteger(Number(e))}function D(e){return Array.from(new Set(O.value.map(n=>n[e])))}const p=w(()=>{const n=typeof M.value[0]=="string",i=M.value[1]<=100;return n?(t.setXAxisIsLog(!1),{type:"band"}):!n&&i?(t.setXAxisIsLog(!1),{type:"linear"}):(t.setXAxisIsLog(!0),{type:"log"})});k(()=>p.value,(e,n)=>{const i=e.type!==n.type;ye(i)},{deep:!1}),k(()=>o.value,async(e,n)=>{await B(),e==="occupation"&&await E("increased"),n==="occupation"&&await E("regular")}),k(()=>m.value,()=>{B()}),k(()=>L.value,()=>{U(O.value)});const G=T(null),V=T(null);k(()=>t.newFetchingDone,async e=>{e&&B()});const j=T(null);async function ee(){await de(),await te()}async function de(){const e=f.select("#grand-council-basel");await ge(e),d.value=e.append("svg").attr("id","svg-visualization").attr("viewBox",`0 0 ${l.value.width} ${l.value.height}`),g.value=d.value.append("g").attr("id","visualization-ctr").attr("transform",`translate(${l.value.margin.left}, ${l.value.margin.top})`)}async function E(e){const n=e==="increased"?_.value*100*1.1:l.value.height,i=e==="increased"?"270":"0",v=f.transition().duration(2500),x=v.transition().duration(1500);await d.value.transition(v).attr("viewBox",`0 0 ${l.value.width} ${n}`).attr("transform",`rotate(${i})`),e==="increased"&&await V.value.selectAll("text").transition(x).style("text-anchor","start").style("font-size",()=>r.isMobile?"6px":"14px").attr("dy",()=>r.isMobile?"-0.1rem":".1rem").attr("dx",()=>-l.value.ctrHeight+X.value*b.value*2).attr("transform","rotate(90)")}async function ge(e){l.value.width=e.node().getBoundingClientRect().width;const n=r.isMobile?.5:.3;l.value.height=l.value.width*n,l.value.margin.top=r.isMobile?10:50,l.value.margin.right=r.isMobile?5:25,l.value.margin.bottom=r.isMobile?18:25,l.value.margin.left=r.isMobile?5:25,l.value.ctrWidth=l.value.width-l.value.margin.left-l.value.margin.right,l.value.ctrHeight=l.value.height-l.value.margin.top-l.value.margin.bottom}async function pe(){const e={arrangement:null,feature:null,featurePlural:null};if(o.value)if($(o.value)){const i=(t.asOfDate?t.listOfVotesAsOfDate:t.listOfVotesCurrent).find(v=>v.voteNr===o.value);e.arrangement=i.voteTitle}else e.arrangement=s(`seatSelection.${o.value}`);if(m.value){const n=["party","fraction","constituency","gender","ageGroup","occupation"];if($(m.value)){const v=(t.asOfDate?t.listOfVotesAsOfDate:t.listOfVotesCurrent).find(x=>x.voteNr===m.value);e.feature=v.voteTitle}else e.feature=s(`seatSelection.${m.value}`),n.includes(m.value)&&(e.featurePlural=s(`seatSelection.${m.value}.plural`))}return e}async function B(){await O.value.sort((v,x)=>{if(o.value){if(v[o.value]<x[o.value])return-1;if(v[o.value]>x[o.value])return 1}if(m.value){if(v[m.value]<x[m.value])return-1;if(v[m.value]>x[m.value])return 1}else{if(v.name<x.name)return-1;if(v.name>x.name)return 1}});let e=null,n=-1,i=-1;if(O.value.forEach(v=>{v[o.value]!==e?(e=v[o.value],n=0):n+=1,v.innerIndex=n,n>i&&(i=n)}),X.value=i+1,o.value||m.value){const v=await pe(),x=await We(O.value,o.value,m.value,v);t.setSummaryText(x)}else t.setSummaryText(null);await Te(),await U(O.value)}async function te(){await xe(),await he()}async function xe(){p.value.type==="band"?G.value=f.scaleBand().domain(M.value).range([0,l.value.ctrWidth]).paddingInner(.2).paddingOuter(.2).align(.5):p.value.type==="linear"?G.value=f.scaleLinear().domain(M.value).range([0,l.value.ctrWidth]).nice():G.value=f.scaleLog().domain(M.value).range([l.value.ctrWidth*.05,l.value.ctrWidth]).base(2).nice()}async function he(){V.value=g.value.append("g").attr("id","x-axis").attr("transform",`translate(0, ${l.value.ctrHeight})`).style("font-size",()=>r.isMobile?"8px":"14px"),ne()}async function ye(e){e?(f.select("#x-axis").remove(),te()):(G.value.domain(M.value),ne())}function ne(){const e=f.formatLocale({thousands:"'",grouping:[3]}).format(",.0f"),n=f.axisBottom(G.value);if(p.value.type==="band"&&n.tickSize(0),p.value.type==="linear"){const i=M.value[1]<10?M.value[1]:12;n.tickSize(-l.value.ctrHeight).ticks(i).tickPadding(10).tickSizeOuter(0).tickFormat(e)}p.value.type==="log"&&n.tickSize(-l.value.ctrHeight).ticks(5).tickPadding(10).tickSizeOuter(0).tickFormat(e),V.value.transition().call(n),p.value.type==="band"?V.value.call(i=>i.select(".domain").remove()):V.value.selectAll(".tick line").style("stroke","lightgrey").style("stroke-dasharray","4,2")}const X=T(0),F=w(()=>p.value.type==="band"?Math.ceil(ut/M.value.length):1),ae=w(()=>p.value.type==="band"?Math.ceil(X.value/F.value):X.value),be=w(()=>p.value.type==="band"?G.value.bandwidth():null),_=w(()=>p.value.type==="band"?be.value/F.value:l.value.ctrWidth/(M.value[1]-M.value[0])),H=w(()=>l.value.ctrHeight/ae.value),b=w(()=>{const n=_.value/2*.9,i=H.value/2*.9;return p.value.type==="band"?ae.value>F.value?Math.min(n,i):n:p.value.type==="linear"?Math.min(n,i):r.isMobile?3.3:5});function P(e){return p.value.type==="band"?Me(e):p.value.type==="linear"?Oe(e):$e(e)}function W(e,n="update"){return n==="enter"?-b.value*2:n==="exit"?l.value.ctrHeight+b.value*2:p.value.type==="band"?we(e):p.value.type==="linear"?Se(e):Ge(e)}function Me(e){const n=o.value?e[o.value]:"",i=e.innerIndex%F.value;return G.value(n)+i*_.value+_.value/2}function we(e){const n=Math.floor(e.innerIndex/F.value);return o.value!=="occupation"?M.value[0]===""?n*H.value+H.value/2:n*H.value:n*b.value*2}function Oe(e){return G.value(e[o.value])}function Se(e){return l.value.ctrHeight-b.value-e.innerIndex*b.value*2}function $e(e){return e[o.value]!==0?G.value(e[o.value]):10}function Ge(e){return l.value.ctrHeight-b.value-e.innerIndex*b.value*2}const re=w(()=>p.value.type==="log"?.65:.9);function Ae(e){return e in J||$(e)}const K=w(()=>{if(!m.value)return{};const e=D(m.value),n=$(e[0]);let i,v;if(n){const x=f.min(e),A=f.max(e);i=A-x>100?"log":"linear",v=A-x>100&&x===0?[1,A]:[x,A]}else i=Ae(m.value)?"custom":"ordinal",v=e.sort();return{type:i,domain:v}});async function Te(){const{type:e,domain:n}=K.value,i={ordinal:()=>f.scaleOrdinal().domain(n).range(He),linear:()=>f.scaleLinear().domain(n).range([N.lowColor,N.highColor]),log:()=>f.scaleLog().domain(n).range([N.lowColor,N.highColor]),default:()=>null};j.value=(i[e]||i.default)()}function R(e){if(!m.value)return"#000000";if(K.value.type==="custom"){const n=e[m.value];return $(m.value)?J.vote[n]:J[m.value][n]}return K.value.type==="log"&&e[m.value]===0?N.logZeroColor:j.value(e[m.value])}const h=T(null);function le(e){const n=t.focusOptions.findIndex(i=>i.value===e.id);return ce[n%ce.length]}async function U(e){let n=g.value.select(".seats-group");n.empty()&&(n=g.value.append("g").attr("class","seats-group"));const i=f.transition().duration(2500),v=t.numberOfFetches===1?f.transition().duration(2500):i.transition().duration(2500),x=f.transition().duration(2500),A=n.selectAll("circle").data(e,u=>u.id);A.exit().transition(i).attr("cx",u=>P(u)).attr("cy",u=>W(u,"exit")).attr("r",b.value).attr("fill",u=>R(u)).attr("fill-opacity",0).remove(),A.enter().append("circle").attr("class","seat").attr("cx",u=>P(u)).attr("cy",u=>W(u,"enter")).attr("r",b.value).attr("fill",u=>R(u)).attr("fill-opacity",0).attr("stroke",u=>u.focus?le(u):null).attr("stroke-width",u=>u.focus?b.value*2:null).attr("stroke-opacity",u=>u.focus?oe:null).on("click",(u,I)=>{r.isMobile||window.open(I.url,"_blank")}).on("mouseover",(u,I)=>setTimeout(()=>{ke(I)},r.isMobile?100:0)).on("mousemove",u=>Ce(u)).on("mouseout",()=>Le()).on("contextmenu",(u,I)=>De(u,I)).transition(v).attr("cx",u=>P(u)).attr("cy",u=>W(u)).attr("fill",u=>R(u)).attr("fill-opacity",re.value).attr("cursor","pointer"),A.transition(x).attr("cx",u=>P(u)).attr("cy",u=>W(u)).attr("r",b.value).attr("fill",u=>R(u)).attr("fill-opacity",re.value).attr("stroke",u=>u.focus?le(u):null).attr("stroke-width",u=>u.focus?b.value*2:null).attr("stroke-opacity",u=>u.focus?oe:null).attr("cursor","pointer"),f.select(".seats-group").raise()}let Y=!1;function ke(e){if(t.membersAsOfDate||h.value.select(".headshot img").attr("src",e.image),h.value.select(".name").text(e.name),o.value===m.value?h.value.select(".arrangement").text(e[o.value]):(h.value.select(".arrangement").text(e[o.value]),h.value.select(".feature").text(e[m.value])),r.isMobile){const i=h.value.select(".url").select("a");i.attr("href",e.url),i.on("click",v=>{v.stopPropagation(),Y=!0})}h.value.style("visibility","visible")}function Ce(e){h.value.style("left",`${e.clientX+b.value}px`).style("top",`${e.clientY-b.value}px`)}function Le(){r.isMobile?setTimeout(()=>{Y&&(Y=!1),Z()},Y?1500:0):setTimeout(()=>{Z()},0)}function Z(){t.membersAsOfDate||h.value.select(".headshot img").attr("src",null),h.value.select(".name").text(null),h.value.select(".arrangement").text(null),h.value.select(".feature").text(null),h.value.select(".hint").text(null),r.isMobile&&h.value.select(".url").select("a").attr("href",""),h.value.style("visibility","hidden")}function De(e,n){e.preventDefault(),t.memberFocus?L.value.includes(n.id)||t.setMemberFocus([...L.value,n.id]):t.setMemberFocus([n.id])}return(e,n)=>(ue(),ie("div",at,[se(t).membersAsOfDate?Be("",!0):(ue(),ie("div",rt,n[0]||(n[0]=[C("img",null,null,-1)]))),n[2]||(n[2]=C("div",{class:"name"},null,-1)),n[3]||(n[3]=C("div",{class:"arrangement"},null,-1)),n[4]||(n[4]=C("div",{class:"feature"},null,-1)),Xe(C("div",lt,n[1]||(n[1]=[C("a",{href:"",target:"_blank"},"Link",-1)]),512),[[_e,se(r).isMobile]])]))}},vt=Ve(it,[["__scopeId","data-v-14426465"]]);export{vt as default};
